{"ast":null,"code":"import _toConsumableArray from\"/Users/mbpa1502/Documents/kundaliweb/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/mbpa1502/Documents/kundaliweb/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/mbpa1502/Documents/kundaliweb/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/mbpa1502/Documents/kundaliweb/node_modules/@babel/runtime/regenerator/index.js\";import{useState,useEffect}from\"react\";import{config,useClient,useMicrophoneAndCameraTracks,channelName}from\"./settings.js\";import{Grid}from\"@material-ui/core\";import Video from\"./Video\";import Controls from\"./Controls\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function VideoCall(props){var setInCall=props.setInCall;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),users=_useState2[0],setUsers=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),start=_useState4[0],setStart=_useState4[1];var client=useClient();var _useMicrophoneAndCame=useMicrophoneAndCameraTracks(),ready=_useMicrophoneAndCame.ready,tracks=_useMicrophoneAndCame.tracks;useEffect(function(){var init=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(name){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:client.on(\"user-published\",/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(user,mediaType){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return client.subscribe(user,mediaType);case 2://alert(mediaType)\nif(mediaType===\"video\"){setUsers(function(prevUsers){return[].concat(_toConsumableArray(prevUsers),[user]);});}if(mediaType===\"audio\"){user.audioTrack.play();}case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x2,_x3){return _ref2.apply(this,arguments);};}());client.on(\"user-unpublished\",function(user,mediaType){if(mediaType===\"audio\"){if(user.audioTrack)user.audioTrack.stop();}if(mediaType===\"video\"){setUsers(function(prevUsers){return prevUsers.filter(function(User){return User.uid!==user.uid;});});}});client.on(\"user-left\",function(user){setUsers(function(prevUsers){return prevUsers.filter(function(User){return User.uid!==user.uid;});});});_context2.prev=3;_context2.next=6;return client.join(config.appId,name,null,null);case 6:_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](3);console.log(\"error\");case 11:if(!tracks){_context2.next=14;break;}_context2.next=14;return client.publish([tracks[0],tracks[1]]);case 14:setStart(true);case 15:case\"end\":return _context2.stop();}}},_callee2,null,[[3,8]]);}));return function init(_x){return _ref.apply(this,arguments);};}();if(ready&&tracks){try{init(channelName);}catch(error){console.log(error);}}},[channelName,client,ready,tracks]);return/*#__PURE__*/_jsxs(Grid,{container:true,direction:\"column\",style:{height:\"100%\"},children:[/*#__PURE__*/_jsx(Grid,{item:true,style:{height:\"5%\"},children:ready&&tracks&&/*#__PURE__*/_jsx(Controls,{tracks:tracks,setStart:setStart,setInCall:setInCall})}),/*#__PURE__*/_jsx(Grid,{item:true,style:{height:\"95%\",width:\"50%\"},children:start&&tracks&&/*#__PURE__*/_jsx(Video,{tracks:tracks,users:users})})]});}","map":{"version":3,"sources":["/Users/mbpa1502/Documents/kundaliweb/src/VideoCall.js"],"names":["useState","useEffect","config","useClient","useMicrophoneAndCameraTracks","channelName","Grid","Video","Controls","VideoCall","props","setInCall","users","setUsers","start","setStart","client","ready","tracks","init","name","on","user","mediaType","subscribe","prevUsers","audioTrack","play","stop","filter","User","uid","join","appId","console","log","publish","error","height","width"],"mappings":"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","sourcesContent":["import { useState, useEffect } from \"react\";\nimport {\n  config,\n  useClient,\n  useMicrophoneAndCameraTracks,\n  channelName,\n} from \"./settings.js\";\nimport { Grid } from \"@material-ui/core\";\nimport Video from \"./Video\";\nimport Controls from \"./Controls\";\n\nexport default function VideoCall(props) {\n  const { setInCall } = props;\n  const [users, setUsers] = useState([]);\n  const [start, setStart] = useState(false);\n  const client = useClient();\n  const { ready, tracks } = useMicrophoneAndCameraTracks();\n\n  useEffect(() => {\n    let init = async (name) => {\n      client.on(\"user-published\", async (user, mediaType) => {\n        await client.subscribe(user, mediaType);\n      //alert(mediaType)\n        if (mediaType === \"video\") {\n          setUsers((prevUsers) => {\n            return [...prevUsers, user];\n          });\n        }\n        if (mediaType === \"audio\") {\n          user.audioTrack.play();\n        }\n      });\n\n      client.on(\"user-unpublished\", (user, mediaType) => {\n        if (mediaType === \"audio\") {\n          if (user.audioTrack) user.audioTrack.stop();\n        }\n        if (mediaType === \"video\") {\n          setUsers((prevUsers) => {\n            return prevUsers.filter((User) => User.uid !== user.uid);\n          });\n        }\n      });\n\n      client.on(\"user-left\", (user) => {\n        setUsers((prevUsers) => {\n          return prevUsers.filter((User) => User.uid !== user.uid);\n        });\n      });\n\n      try {\n        await client.join(config.appId, name, null, null);\n      } catch (error) {\n        console.log(\"error\");\n      }\n\n      if (tracks) await client.publish([tracks[0], tracks[1]]);\n      setStart(true);\n    };\n\n    if (ready && tracks) {\n      try {\n        init(channelName);\n      } catch (error) {\n        console.log(error);\n      }\n    }\n  }, [channelName, client, ready, tracks]);\n\n  return (\n    <Grid container direction=\"column\" style={{ height: \"100%\" }}>\n      <Grid item style={{ height: \"5%\" }}>\n        {ready && tracks && (\n          <Controls tracks={tracks} setStart={setStart} setInCall={setInCall} />\n        )}\n      </Grid>\n      <Grid item style={{ height: \"95%\" ,width:\"50%\"}}>\n\n        {start && tracks && <Video tracks={tracks} users={users} />}\n      </Grid>\n    </Grid>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}